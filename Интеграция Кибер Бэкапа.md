### Интеграция Кибер Бэкапа с СХД TATLIN.BACKUP.

В этой статье рассмотрим сценарии совместного использования системы резервного копирования Кибер Бэкап и хранилища резервных копий TATLIN.BACKUP от компании YADRO. 

Интеграция СРК и СХД позволяет сформировать надежную и высокопроизводительную среду для защиты данных, оптимизировать вычислительные ресурсы и обеспечить стабильную работу ИТ-инфраструктуры.

В рассматриваемых сценариях используются следующие протоколы подключения: T-BOOST, SMB/CIFS, NFS.

Протокол T-BOOST

Протокол передачи данных T-BOOST предназначен для повышения эффективности и производительности процессов резервного копирования данных. 

Его ключевая особенность заключается в дедупликации данных на источнике (хосте) и передаче в хранилище только уникальных данных. 

Для этого на хост устанавливается специальный плагин.

<img width="864" height="725" alt="image" src="https://github.com/user-attachments/assets/536bd0d0-4c2b-4c4a-8eaf-716c108cfaaa" />

#### Сценарии интеграции СРК Кибер Бэкап с СХД TATLIN.BACKUP.

Можно выделить три основных сценария совместной работы продуктов, в зависимости от того, используется ли протокол T-BOOST и, если используется, куда устанавливается плагин – на каждый защищаемый хост или на узел хранения Кибер Бэкапа. Выбор сценария определяется тем, какие ресурсы необходимо сберечь.

Сценарий 1. Экономия ресурсов продуктивной среды.

Заказчику нельзя тратить процессорные ресурсы и память защищаемого хоста на дедупликацию и сжатие плагином T-BOOST.

Для решения этой задачи все блоки без исключения отправляются по сети с использованием протокола SMB/CIFS или NFS, дедупликация и компрессия выполняется на стороне СХД.

<img width="604" height="624" alt="image" src="https://github.com/user-attachments/assets/c0936c8c-d305-405a-8582-bc70c9a946c2" />

Сценарий 2. Оптимизация трафика на защищаемом хосте

Заказчику требуется оптимизировать (уменьшить) трафик резервного копирования на источнике данных перед его отправкой по сети в хранилище резервных копий.

Для решения этой задачи на хосте, где установлен агент Кибер Бэкапа, устанавливается также плагин T-BOOST, который выполняет глобальную дедупликацию на уровне TATLIN.BACKUP и сжатие данных непосредственно на хосте. 

В рамках этой операции в хранилище передаются только предварительно сжатые уникальные блоки данных. 

Вместо блоков, которые ранее уже были записаны, передаются только их метаданные.

<img width="698" height="678" alt="image" src="https://github.com/user-attachments/assets/32f7eb9e-20ab-453b-b252-f7456a416f4f" />

Сценарий 3. Гибридное решение по оптимизации

Заказчику нельзя тратить процессорные ресурсы и память защищаемого хоста на дедупликацию и сжатие плагином T-BOOST, но требуется передавать резервные копии по узкому каналу в СХД TATLIN.BACKUP, расположенную в удаленном ЦОД.

Для решения этой задачи трафик в полном объеме передается по протоколу SMB/CIFS или NFS на локальный узел хранения (медиасервер), где плагин T-BOOST выполняет дедупликацию и сжатие данных и затем передает их в оптимизированном виде в удаленную СХД TATLIN.BACKUP.

<img width="698" height="747" alt="image" src="https://github.com/user-attachments/assets/73517dfa-7286-4375-90dc-4933d5950e33" />

Инструкции по настройке СХД TATLIN.BACKUP
Сценарий 1. Подключение СХД без использования протокола T-BOOST

1. В интерфейсе TATLIN.BACKUP создайте виртуальную файловую систему:

Перейдите на вкладку -> Хранилище.

В разделе Виртуальные файловые системы нажмите -> Создать.

<img width="1376" height="1032" alt="image" src="https://github.com/user-attachments/assets/7143b5f7-77c0-4655-9c6e-87eff29c9a16" />

В открывшемся окне в поле Имя введите название файловой системы и нажмите -> Создать.

<img width="474" height="319" alt="image" src="https://github.com/user-attachments/assets/bdaffd73-5bca-410e-8a02-06dab91335e4" />

2. Создайте сетевой ресурс для виртуальной файловой системы:

В списке выберите вновь созданную файловую систему.

На панели справа выберите протокол для доступа к сетевому ресурсу: NFS или SMB, в зависимости от используемой операционной системы. Нажмите -> Создать.

<img width="2904" height="1536" alt="image" src="https://github.com/user-attachments/assets/402eafe4-7d62-4a8a-8011-208878825870" />

В открывшемся окне заполните необходимые поля и нажмите -> Создать.

3. В веб-консоли Кибер Бэкапа добавьте сетевой ресурс как место хранения резервных копий:

- Создайте новый план защиты или выберите существующий.
- В настройках плана выберите Место сохранения.
- Нажмите -> Добавить хранилище.
- Выберите -> Сетевая папка (для SMB) или -> Папка NFS.
- В поле ввода на панели справа укажите полный путь к ранее созданному сетевому ресурсу и нажмите -> Добавить.

>Общие рекомендации по использованию СХД TATLIN.BACKUP
```bash
Рекомендуется запускать одновременно несколько заданий резервного копирования, так как TATLIN.BACKUP обеспечивает максимальную производительность именно при параллельной работе со множеством потоков резервного копирования. Для этого в один план добавляйте несколько агентов или виртуальных машин. Для заданий резервного копирования на уровне гипервизора регулировать количество потоков (параллельных заданий резервного копирования виртуальных машин) можно с помощью параметра Планирование.
Для оптимальной производительности рекомендуется использовать протокол SMB версии не ниже 2.1. Версия используемого протокола зависит от операционной системы, в которой работает агент Кибер Бэкапа, так как все операции монтирования и передачи данных происходят через инструменты ОС.

При использовании хранилища NFS необходимо отключить для агента возможность блокировки файлов резервных копий, так как на стороне хранилища блокировки не поддерживаются.
```
Сценарии 2 и 3. Подключение СХД с установкой плагина T-BOOST на защищаемом хосте или узле хранения Кибер Бэкапа

1. В интерфейсе TATLIN.BACKUP создайте виртуальную файловую систему:

Перейдите на вкладку -> Хранилище.

В разделе Виртуальные файловые системы нажмите кнопку -> Создать.

<img width="1376" height="1032" alt="image" src="https://github.com/user-attachments/assets/40de49ec-5fde-48d6-918b-8802ff05bca9" />

В открывшемся окне в поле Имя введите название файловой системы и нажмите Создать.

<img width="474" height="319" alt="image" src="https://github.com/user-attachments/assets/36e53bc0-3f47-4892-92e1-d9d7ae26092d" />

2. Включите сервис T-BOOST:

В списке выберите вновь созданную файловую систему.

На панели справа перейдите на вкладку T-BOOST и нажмите кнопку Включить.

<img width="2904" height="1536" alt="image" src="https://github.com/user-attachments/assets/ecb43bfb-7f41-442f-9c12-67070d8dec8d" />

3. Установите плагин T-BOOST на защищаемый хост или узел хранения Кибер Бэкапа.

Для установки пакета на Astra Linux, Ubuntu или Debian используйте apt:
```bash
apt install ./tb-agent_0.0.0+20240621.git0ec7389f-0_amd64.deb
```
Для установки пакета на SberLinux OS или РЕД ОС используйте dnf:
```bash
dnf install ./tb_agent-0.0.0+20240621.git0ec7389f-0.x86_64.rpm
```
4. На защищаемом хосте или узле хранения Кибер Бэкапа примонтируйте сетевой ресурс TATLIN.BACKUP по протоколу T-BOOST.

Создайте локальную папку для монтирования:
```bash
mkdir <MOUNTPOINT>
```
Запретите изменения для папки:
```bash
chattr +i <MOUNTPOINT>
```
Выполните монтирование виртуальной файловой системы:
```bash
tboostctl mount --export <FS_NAME> --tcp-addr=<TB_IP>:<TB_PORT> <MOUNTPOINT>
```
Для проверки работоспособности плагина T-BOOST можно записать тестовые данные в локальную папку <MOUNTPOINT>.
Параметры:
```bash
<FS_NAME> – имя удаленной виртуальной файловой системы для T-BOOST
<TB_IP, TB_PORT> – IP-адрес и порт T-BOOST СХД TATLIN.BACKUP
<MOUNTPOINT> – точка монтирования, локальная папка, подготовленная заранее на защищаемом хосте или узле хранения Кибер Бэкапа
```
Полную инструкцию по настройке протокола T-BOOST см. в «Руководстве по настройке T-BOOST» на сайте производителя: https://docs.yadro.com или https://service.yadro.com.

Для локальной папки, к которой будет монтироваться сетевой ресурс TATLIN.BACKUP по протоколу T-BOOST, обязательно нужно запретить изменения.

Если оставить права доступа по умолчанию (с возможностью записи), в случае недоступности сетевого устройства TATLIN.BACKUP резервное копирование будет выполняться в локальную папку, что может привести к перерасходу дискового пространства и проблемам с работоспособностью и доступностью операционной системы в целом.

5. Добавьте СХД TATLIN.BACKUP как хранилище резервных копий в Кибер Бэкапе.

Настройка неуправляемого хранилища в сценарии с установкой плагина на защищаемом хосте (сценарий 2)

- В веб-консоли Кибер Бэкапа создайте новый план защиты или выберите существующий.
- В настройках плана выберите Место сохранения.
- Нажмите Добавить хранилище.
- Выберите Локальная папка.
- В поле ввода на панели справа укажите полный путь к локальной папке, к которой примонтирован сетевой ресурс TATLIN.BACKUP, и нажмите Добавить.
- Для максимально эффективного использования вычислительных ресурсов хоста и сетевого канала необходимо отключить сжатие в параметрах резервного копирования в плане защиты.

Настройка управляемого хранилища в сценарии с установкой плагина на узле хранения (сценарий 3)

- В веб-консоли Кибер Бэкапа создайте новый план защиты или выберите существующий.
- В настройках плана выберите Место сохранения.
- Нажмите Добавить хранилище.
- Выберите Узел хранения.
- Создайте управляемое хранилище на узле хранения:
- Введите имя управляемого хранилища.
- Выберите узел хранения, который будет управлять хранилищем.
- В поле Путь укажите папку, в которую было подключено хранилище TATLIN.BACKUP по протоколу T-BOOST.
- Нажмите Готово.

При настройке управляемого хранилища необходимо выключить дедупликацию на уровне хранилища и защиту хранилища паролем.



